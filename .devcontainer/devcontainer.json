{
    "name": "OpenBMC Development",
    "build": {
        "dockerfile": "../docker/Dockerfile",
        "context": "../docker"
    },
    "updateRemoteUserUID": true,
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools",
                "ms-vscode.cpptools-extension-pack",
                "ms-python.python",
                "ms-python.vscode-pylance",
                "redhat.vscode-yaml",
                "yocto-project.yocto-bitbake",
                "mhutchie.git-graph",
                "eamodio.gitlens",
                "streetsidesoftware.code-spell-checker"
            ],
            "settings": {
                "terminal.integrated.defaultProfile.linux": "bash",
                "editor.tabSize": 4,
                "editor.insertSpaces": true,
                "files.trimTrailingWhitespace": true,
                "C_Cpp.default.compilerPath": "/usr/bin/gcc",
                "C_Cpp.default.cStandard": "c17",
                "C_Cpp.default.cppStandard": "c++20",
                "python.defaultInterpreterPath": "/usr/bin/python3"
            }
        }
    },
    "mounts": [
        "source=${localWorkspaceFolder}/../openbmc,target=/workspace/openbmc,type=bind",
        "source=openbmc-sstate-cache,target=/workspace/openbmc/build/sstate-cache,type=volume",
        "source=openbmc-downloads,target=/workspace/openbmc/build/downloads,type=volume",
        "source=${localEnv:SSH_AUTH_SOCK},target=/ssh-agent,type=bind"
    ],
    "workspaceFolder": "/workspace/openbmc",
    "remoteUser": "openbmc",
    "containerEnv": {
        "LANG": "en_US.UTF-8",
        "LC_ALL": "en_US.UTF-8",
        "SSH_AUTH_SOCK": "/ssh-agent"
    },
    "onCreateCommand": "if [ ! -d /workspace/openbmc ]; then echo '\\n*** ERROR: openbmc source not found. Clone it next to this repo: git clone https://github.com/openbmc/openbmc.git ***\\n' && exit 1; fi",
    "postCreateCommand": "git config --global --add safe.directory /workspace/openbmc",
    "postStartCommand": "if [ -f /workspace/openbmc/oe-init-build-env ]; then echo \"export PARALLEL_MAKE=\\\"-j$(nproc)\\\"\" >> ~/.bashrc && echo \"export BB_NUMBER_THREADS=$(nproc)\" >> ~/.bashrc && echo 'source /workspace/openbmc/oe-init-build-env' >> ~/.bashrc; fi",
    "forwardPorts": [2222, 2443, 2623],
    "portsAttributes": {
        "2222": {"label": "BMC SSH"},
        "2443": {"label": "BMC HTTPS/Redfish"},
        "2623": {"label": "BMC IPMI"}
    }
}
